---
title: "fastTS Analysis - DE"
author: "Federico Deotto"
date: "2024-04-28"
output: html_document
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(ggsci)
library(scales)
library(shiny)
library(ncvreg)

library(fastTS)
library(xts)


source('builtin_functions.R')


setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# Default theme for charts
theme_set(
  theme_bw() +
    theme(  
      plot.title = element_text(face = "bold", size = 14),
      plot.subtitle = element_text(
        face = "italic", size = 10, colour = "green50"
      )
    )
)

```

## The Goal

Study the models adapted fro the day_ahead_price_de 

```{r}
#df <- read_csv("../00 Data Retrieval and Cleaning/0_df_final_imputed_shifting_a.csv") %>% 
#  select(date, day_ahead_price_de) %>% 
#  slice(25:n()) %>% 
#  mutate( day_ahead_price_de_log = boxcox_transform(day_ahead_price_de, lambda = 0)) 
```

```{r}
first_cut <- as.POSIXct("2021-06-30 23:00:00", tz = "UTC")
second_cut <- as.POSIXct("2022-12-31 23:00:00", tz = "UTC")
```

# FULL TIME WINDOW


# A
```{r}
mod <- readRDS("fastTS_de/mod_a_1_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

# B
```{r}
mod <- readRDS("fastTS_de/mod_b_1_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

# C
```{r}
mod <- readRDS("fastTS_de/mod_c_1_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```


# First Period 

# A
ACF $ PACF present a good behavior but all other diagnostics are not promising.
```{r}
mod_a <- readRDS("fastTS_de/mod_a_2_de.rds")
read_coef(mod_a)
model_a <- mod_a$fits[[1]]  #the best lambda is zero = no penalization OLS
sum_stat <- model_selected(mod_a, model_a, p.train = 0.8)
rm(mod_a, model_a, sum_stat)
```


```{r}
summary(mod_a)
```


# B
This model is even worst then A.
```{r}
mod_b <- readRDS("fastTS_de/mod_b_2_de.rds")
read_coef(mod_b)
model_b <- mod_b$fits[[1]]  #the best lambda is zero = no penalization OLS
sum_stat <- model_selected(mod_b, model_b, p.train = 0.8)
rm(mod_b, model_b, sum_stat)
```

# C
This model NEED to be FITTED.


# Second Period

# A
ACF & PACF are fine, the other diagnostics are not good. Once again the type A present this bhaviour. 
```{r}
mod <- readRDS("fastTS_de/mod_a_3_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

# B
```{r}
mod <- readRDS("fastTS_de/mod_b_3_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

# C
```{r}
mod <- readRDS("fastTS_de/mod_c_3_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```


# Third Period


I have to fit again the model adding a dummy for the xtreme value. 
The model type_a (company) is the one that meet best the assumptions of teh model. This is interesting and quite surprising to me since in this sense it outperform the model type_c the contains more predictor. (subset).




# A
This model reach good results in term of diagnostic. 
```{r}
mod <- readRDS("fastTS_de/mod_a_4_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
#rm(mod, model, sum_stat)
```
```{r}
mod$oos_results
```





# B
This model clearly present MA, and AR component not incorporeted into the model.
```{r}
mod <- readRDS("fastTS_de/mod_b_4_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

```{r}
model_selected(mod, model, p.train = 0.8, lag.max = 24*7)
```


# C
```{r}
mod <- readRDS("fastTS_de/mod_c_4_de.rds")
read_coef(mod)
model <- mod$fits[[1]]  
sum_stat <- model_selected(mod, model, p.train = 0.8)
rm(mod, model, sum_stat)
```

